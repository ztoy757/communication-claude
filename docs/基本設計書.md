1. システム概要 (System Overview)
本SNSは、マルチモジュール構成のJava製モノリスWebアプリケーションとして構築されます。単一のデプロイメントユニット（例: JAR/WARファイル）として稼働し、プレゼンテーション層、ビジネスロジック層、データアクセス層が統合された形で動作します。マルチモジュール化により、関心の分離と開発効率の向上を図ります。

フロントエンド: ユーザーが直接操作するWebブラウザベースのインターフェース。HTML, CSS, JavaScriptで構成。

バックエンド: Javaで実装されたサーバーサイドアプリケーション。ユーザーからのリクエストを処理し、ビジネスロジックを実行、データベースとの連携、外部API連携などを行う。

データベース: PostgreSQLを採用し、アプリケーションのデータを永続的に保存。

外部API: 書籍情報（書名、著者、ISBN、表紙画像など）の取得に利用。

graph TD
    A[ユーザー] -->|HTTP Request| B[フロントエンド (ブラウザ)]
    B -->|HTTP Request (REST API)| C[JavaモノリスWebアプリ]
    C -->|JPA/JDBC| D[PostgreSQLデータベース]
    C -->|HTTP Request| E[外部書籍情報API]

    subgraph JavaモノリスWebアプリ
        C1[プレゼンテーション層]
        C2[ビジネスロジック層]
        C3[データアクセス層]
        C4[共通モジュール]
        C5[セキュリティモジュール]
    end

    C1 --> C2
    C2 --> C3
    C2 --> C5
    C3 --> D
    C2 --> E

2. 機能設計 (Functional Design)
要件定義書で定義された各機能の概要と、基本的な動作フローを記述します。

2.1. ユーザー管理機能
会員登録・ログイン:

ユーザーはメールアドレスとパスワードを設定し、バックエンドの認証ロジックを通じてアカウントを作成。パスワードはハッシュ化され安全に保存されます。

ログイン時は提供された認証情報をバックエンドで検証し、Spring Securityを利用してセッション管理またはJWT（JSON Web Token）ベースの認証を行います。

SNS連携ログインの場合、Spring Security OAuth2などを利用し、各プラットフォームのOAuth認証フローを経てユーザー情報を取得し、システムに紐付けます。

プロフィール設定:

プロフィール情報（ユーザー名、自己紹介、好きなジャンル、読書レベル、アバター画像URL）はデータベースに保存されます。

アバター画像はファイルストレージサービス（例: Amazon S3, Google Cloud Storage）に保存し、そのURLをDBに保持します。

アカウント管理:

パスワード変更、メールアドレス変更は既存認証情報の検証後にバックエンドのロジックで実行されます。

退会処理は、ユーザーデータの一部匿名化または関連データの論理削除／物理削除をバックエンドで実行します。

2.2. 読書記録・管理機能
読書リスト:

各書籍のステータス（読みたい本、読んでいる本、読み終わった本、積読本）はユーザーと書籍の関連付けとしてデータベースに保存されます。

ステータス変更時にはタイムスタンプを自動記録し、ユーザーの読書履歴を形成します。

リストはユーザー認証に基づきフィルタリングされ、フロントエンドでソート・表示されます。

本の登録:

フロントエンドからのISBN、書名、著者名などの検索リクエストを受け、バックエンドが外部書籍情報API（例: Google Books API）を呼び出し、書籍情報を取得・表示します。

ユーザーの確認後、取得した書籍情報をデータベースに永続化します。

外部APIで情報が見つからない場合、ユーザーが手動で詳細を入力する機能を設けるか、管理者による書籍情報登録フローを検討します。

読書状況の更新:

「読んでいる本」の現在のページ数、読了日、読了時間などを、ユーザーがバックエンドAPIを通じて更新します。

読了時には、感想・レビュー投稿を促すUI導線をフロントエンドで提示します。

感想・レビュー投稿:

ユーザーは特定の書籍に対して、評価（例: 星1〜5）、感想テキスト、ネタバレ有無フラグ、画像（任意）をバックエンドAPIを通じて投稿します。

ネタバレフラグがTrueの場合、フロントエンドで表示時に隠すCSS/JavaScriptを適用します。

読書メーター:

読了記録や読書ページ数のデータに基づき、バックエンドで累計・月間・年間などの集計処理を行い、フロントエンドに統計データ（例: グラフ描画用データ）を提供します。

本棚の魅力的な見せ方:

ユーザーが自由に「テーマ別」「気分別」などの仮想本棚を作成し、書籍を登録・分類できる機能をバックエンドで管理します。

他のユーザーの本棚は、公開設定に応じてバックエンドでフィルタリングされ、閲覧可能にします。人気本棚の集計や推薦ロジックもバックエンドに実装します。

2.3. コミュニケーション機能
フィード:

フォローしているユーザーの最新活動（レビュー投稿、読書開始/読了報告、引用共有など）は、バックエンドのサービス層で集約され、時系列順にフロントエンドに提供されます。

パーソナライズされたおすすめ投稿は、レコメンドエンジンからの結果をフィードに統合して表示します。

コメント・リアクション:

投稿に対するコメントは、関連する投稿IDとユーザーIDと共にデータベースに保存されます。

「いいね」や読書特有のリアクションは、リアクションタイプと投稿ID、ユーザーIDを関連付けてデータベースに記録します。

グループ・コミュニティ機能:

グループの作成、参加、脱退といった操作はバックエンドのグループ管理サービスで処理されます。

グループ内掲示板、共有本棚、イベント告知なども、各機能のAPIを通じてグループのコンテキスト内で管理されます。

読書会イベント機能:

イベントの企画、参加募集、参加者管理はイベント管理サービスで処理されます。

オンライン読書会の場合は、外部ビデオ通話サービスへのURL提供を行います。

Q&A機能:

質問投稿と回答投稿は、それぞれデータベースに記録され、関連付けられます。

2.4. 本の発見・レコメンド機能
パーソナライズされたレコメンド機能:

ユーザーの読書履歴、評価、レビュー内容からのキーワード抽出、フォロー関係などのデータをバックエンドのレコメンドサービスが分析します。

機械学習アルゴリズムまたはルールベースの推薦ロジックにより、最適な書籍リストを生成し、フロントエンドに提供します。

推薦理由の生成ロジックもバックエンドに実装します。

今日の一冊:

毎日、ユーザーの読書傾向に基づいてバックエンドがパーソナライズされた1冊を選定します。

選定された情報はデータベースに記録され、フロントエンドがホーム画面表示時に取得・表示します。

3. データ設計 (Data Design)
本システムにおける主要なエンティティとリレーションシップを示す論理ER図案です。

erDiagram
    USER {
        VARCHAR user_id PK "ユーザーID"
        VARCHAR username "ユーザー名"
        VARCHAR email "メールアドレス"
        VARCHAR password_hash "パスワードハッシュ"
        TEXT profile_bio "自己紹介"
        VARCHAR avatar_url "アバター画像URL"
        TEXT preferred_genres "好きなジャンル (カンマ区切りなど)"
        VARCHAR reading_level "読書レベル"
        VARCHAR reading_style "読書傾向 (多読派など)"
        TIMESTAMP created_at "登録日時"
        TIMESTAMP last_login_at "最終ログイン日時"
        BOOLEAN is_public_profile "プロフィール公開設定"
    }

    BOOK {
        VARCHAR book_id PK "書籍ID (ISBNなど)"
        VARCHAR title "書名"
        VARCHAR author "著者名"
        VARCHAR publisher "出版社"
        INTEGER publication_year "出版年"
        TEXT synopsis "あらすじ"
        VARCHAR cover_image_url "表紙画像URL"
        VARCHAR genre "ジャンル"
        TIMESTAMP created_at "登録日時"
    }

    BOOK_READING_STATUS {
        VARCHAR status_id PK "読書状況ID"
        VARCHAR user_id FK "ユーザーID"
        VARCHAR book_id FK "書籍ID"
        VARCHAR status "ステータス (読みたい, 読んでいる, 読み終わった, 積読)"
        INTEGER current_page "現在のページ数"
        TIMESTAMP start_date "読書開始日"
        TIMESTAMP finish_date "読了日"
        INTEGER reading_time_minutes "読書時間 (分)"
        VARCHAR mood_at_finish "読了時の気分"
        TIMESTAMP created_at "記録日時"
        TIMESTAMP updated_at "更新日時"
    }

    REVIEW {
        VARCHAR review_id PK "レビューID"
        VARCHAR user_id FK "ユーザーID"
        VARCHAR book_id FK "書籍ID"
        INTEGER rating "評価 (星)"
        TEXT review_text "感想テキスト"
        BOOLEAN has_spoiler "ネタバレ有無"
        TIMESTAMP posted_at "投稿日時"
        VARCHAR image_url "画像URL (任意)"
    }

    REACTION {
        VARCHAR reaction_id PK "リアクションID"
        VARCHAR user_id FK "ユーザーID"
        VARCHAR target_type "対象タイプ (REVIEW, FEED_POST, COMMENTなど)"
        VARCHAR target_id FK "対象ID"
        VARCHAR reaction_type "リアクションタイプ (いいね, 泣いた, 深かったなど)"
        TIMESTAMP reacted_at "リアクション日時"
    }

    COMMENT {
        VARCHAR comment_id PK "コメントID"
        VARCHAR user_id FK "ユーザーID"
        VARCHAR target_type "対象タイプ (REVIEW, FEED_POSTなど)"
        VARCHAR target_id FK "対象ID"
        TEXT comment_text "コメント内容"
        TIMESTAMP commented_at "コメント日時"
    }

    FOLLOW {
        VARCHAR follow_id PK "フォローID"
        VARCHAR follower_user_id FK "フォロー元ユーザーID"
        VARCHAR following_user_id FK "フォロー先ユーザーID"
        TIMESTAMP followed_at "フォロー日時"
    }

    GROUP_ENTITY {
        VARCHAR group_id PK "グループID"
        VARCHAR group_name "グループ名"
        TEXT description "説明"
        VARCHAR created_by_user_id FK "作成ユーザーID"
        TIMESTAMP created_at "作成日時"
        VARCHAR visibility "公開範囲 (公開, 非公開)"
    }

    GROUP_MEMBER {
        VARCHAR member_id PK "メンバーID"
        VARCHAR group_id FK "グループID"
        VARCHAR user_id FK "ユーザーID"
        TIMESTAMP joined_at "参加日時"
        VARCHAR role "役割 (管理者, メンバー)"
    }

    EVENT {
        VARCHAR event_id PK "イベントID"
        VARCHAR group_id FK "グループID (任意)"
        VARCHAR created_by_user_id FK "主催ユーザーID"
        VARCHAR event_name "イベント名"
        TEXT description "説明"
        TIMESTAMP event_datetime "開催日時"
        VARCHAR location_type "場所タイプ (オンライン, オフライン)"
        TEXT location_detail "場所詳細/URL"
        VARCHAR book_id FK "対象書籍ID (任意)"
        INTEGER max_participants "参加者上限"
        TIMESTAMP created_at "作成日時"
    }

    EVENT_PARTICIPATION {
        VARCHAR participation_id PK "参加ID"
        VARCHAR event_id FK "イベントID"
        VARCHAR user_id FK "ユーザーID"
        TIMESTAMP participated_at "参加日時"
    }

    SHELF {
        VARCHAR shelf_id PK "本棚ID"
        VARCHAR user_id FK "ユーザーID"
        VARCHAR shelf_name "本棚名"
        TEXT description "説明"
        BOOLEAN is_public "公開設定"
        TIMESTAMP created_at "作成日時"
    }

    SHELF_ITEM {
        VARCHAR item_id PK "本棚アイテムID"
        VARCHAR shelf_id FK "本棚ID"
        VARCHAR book_id FK "書籍ID"
        TIMESTAMP added_at "追加日時"
    }

    DIRECT_MESSAGE {
        VARCHAR dm_id PK "DM ID"
        VARCHAR sender_user_id FK "送信ユーザーID"
        VARCHAR receiver_user_id FK "受信ユーザーID"
        TEXT message_text "メッセージ内容"
        TIMESTAMP sent_at "送信日時"
        BOOLEAN is_read "既読フラグ"
    }

    FEED_POST {
        VARCHAR post_id PK "投稿ID"
        VARCHAR user_id FK "ユーザーID"
        VARCHAR post_type "投稿タイプ (REVIEW, BOOK_START, BOOK_FINISH, QUOTE)"
        VARCHAR related_book_id FK "関連書籍ID (任意)"
        VARCHAR related_review_id FK "関連レビューID (post_type=REVIEWの場合)"
        TEXT post_text "投稿テキスト (引用など)"
        VARCHAR image_url "画像URL (任意)"
        TIMESTAMP posted_at "投稿日時"
    }

    USER ||--o{ BOOK_READING_STATUS : "Has reading status for"
    USER ||--o{ REVIEW : "Posts"
    USER ||--o{ REACTION : "Reacts to"
    USER ||--o{ COMMENT : "Comments on"
    USER ||--o{ FOLLOW : "Follows/Is followed by"
    USER ||--o{ GROUP_MEMBER : "Is member of"
    USER ||--o{ EVENT_PARTICIPATION : "Participates in"
    USER ||--o{ SHELF : "Owns"
    USER ||--o{ DIRECT_MESSAGE : "Sends/Receives"
    USER ||--o{ FEED_POST : "Posts"

    BOOK ||--|| BOOK_READING_STATUS : "Is status for"
    BOOK ||--|| REVIEW : "Is reviewed in"
    BOOK ||--o{ EVENT : "Is target book of"
    BOOK ||--|| SHELF_ITEM : "Is item in"
    BOOK ||--o{ FEED_POST : "Is related to"

    REVIEW ||--o{ REACTION : "Receives"
    REVIEW ||--o{ COMMENT : "Receives"
    REVIEW ||--o{ FEED_POST : "Is posted as"

    GROUP_ENTITY ||--o{ GROUP_MEMBER : "Has"
    GROUP_ENTITY ||--o{ EVENT : "Organizes"

    EVENT ||--o{ EVENT_PARTICIPATION : "Has"

    SHELF ||--o{ SHELF_ITEM : "Contains"

    FEED_POST ||--o{ REACTION : "Receives"
    FEED_POST ||--o{ COMMENT : "Receives"

ER図の補足事項:
PK (Primary Key): 主キー。テーブル内で一意な行を識別します。VARCHAR型のIDはUUIDなどでの生成を想定しています。

FK (Foreign Key): 外部キー。他のテーブルの主キーを参照し、テーブル間の関連性を示します。

データ型: PostgreSQLの一般的なデータ型を想定しています（VARCHARは文字列、TEXTは長文文字列、INTEGERは整数、BOOLEANは真偽値、TIMESTAMPは日時）。

リレーションシップ:

||--o{: 一対多（"一"側が必須、"多"側が任意）。例：ユーザーは複数の読書状況を持つが、読書状況は1人のユーザーに紐づく。

||--||: 一対一。

}|--||: 多対一（"多"側が必須、"一"側が必須）。

target_typeとtarget_idを使用した汎用的な関連付けにより、ReactionやCommentが様々な投稿タイプに紐づくことを表現しています（ポリモーフィック関連のような概念）。これは実装時にJOIN性能などを考慮して具体化が必要です。

4. UI/UX基本方針 (UI/UX Basic Policy)
「夜にまったりと読める雰囲気」というコンセプトを実現するための具体的なUI/UX方針は、要件定義書の内容に準じます。

カラースキーム: 全体的に低彩度・低明度の色調（深い青、落ち着いた緑、暖かみのあるグレー、ベージュ、ブラウンなど）を基調とし、目に優しい配色とします。

ダークモード: デフォルトでダークモードを採用、またはユーザーが設定で簡単に切り替え可能とします。

フォント: 長文の読書感想や本の情報をストレスなく読めるよう、可読性の高いフォントを選定し、行間・文字間にゆとりを持たせます。

レイアウトと余白: ミニマルなデザインを基本とし、コンテンツ間の十分な余白を確保し、情報過多にならないようにします。

アイコン・イラスト: ラインアイコンやフラットなイラストを採用し、シンプルかつ洗練されたデザインに統一します。

アニメーション: 画面遷移や要素の表示・非表示アニメーションは、滑らかで控えめなものを採用します。

今日の一冊の表示: ホーム画面上部など、目立つが邪魔にならない位置に、本の表紙と簡単な紹介文を配置し、詳細への導線を明確にします。

通知: プッシュ通知は行わず、アプリ内の新着通知（ベルマーク）は、未読件数を数字で表示するのみとします。

5. 外部連携設計 (External Linkage Design)
書籍情報API:

バックエンドからHTTPクライアント（例: Spring WebClient, RestTemplate）を利用して、外部の書籍情報API（例: Google Books API）を呼び出します。

APIからのレスポンスをJavaオブジェクトにマッピングし、アプリケーション内で利用します。

APIの呼び出し頻度制限や利用規約に準拠した実装を行います。

SNS認証API:

Spring Security OAuth2 Clientモジュールなどを利用し、Google, Apple IDなど各SNSプロバイダーのOAuth2.0認証フローに対応します。

6. セキュリティ設計 (Security Design)
認証・認可:

Spring Securityを全面的に採用し、ユーザー認証（パスワードハッシュ化、ソルト利用）、セッション管理またはJWT認証、リソースへの認可（ロールベース、パスベース）を実装します。

パスワードはBCryptなどの強力なハッシュアルゴリズムで保存します。

データ保護:

PostgreSQLへのアクセスは、Spring Data JPAやJDBCを介して行い、SQLインジェクションなどの脆弱性対策を講じます。

個人情報（メールアドレスなど）は適切に暗号化して保存する、またはアクセス制限をかけるなど、保護策を講じます。

通信はHTTPS/SSL/TLSにより暗号化します。

脆弱性対策:

OWASP Top 10などを参考に、XSS、CSRF、セキュアな設定の不備などへの対策を講じます（Spring Securityの機能を利用）。

不適切コンテンツ対策:

ユーザーからの報告機能（通報機能）を実装し、管理者が報告内容を確認・対応できる運用フローを構築します。

必要に応じて、コンテンツフィルタリングやモデレーションツールとの連携も検討します。

7. 開発環境・技術スタック案 (Proposed Development Environment/Tech Stack)
JavaモノリスWebアプリケーションとして以下の技術スタックを想定します。

言語: Java (OpenJDK 17 LTS以降を推奨)

フレームワーク: Spring Boot (最新安定版)

spring-boot-starter-web: Webアプリケーション開発

spring-boot-starter-data-jpa: ORM (Hibernate) を利用したデータアクセス

spring-boot-starter-security: 認証・認可

spring-boot-starter-validation: バリデーション

spring-boot-starter-test: テスト

spring-boot-starter-actuator: 運用監視

ビルドツール: Maven

データベース: PostgreSQL （開発・本番環境）

H2 Database (開発・テスト環境用インメモリデータベース, 必要に応じて)

ORM: Hibernate (Spring Data JPAを通じて利用)

サーバー: Embedded Tomcat (Spring Boot標準)

依存性注入: Spring IoC Container

ログ: SLF4J / Logback

ユーティリティ: Lombok (ボイラープレートコード削減)

バージョン管理: Git

テスト: JUnit 5, Mockito

クラウドプラットフォーム: AWS, GCP, Azure （デプロイ環境として）

PostgreSQLとMavenの指定を反映させ、ER図（論理ER図案）を記載した基本設計書を提示いたしました。

ER図の内容について、もし修正点や追加のご要望がありましたら、お知らせください。